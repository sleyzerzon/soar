
#sp {prefer*place-adjacent
#	(state <s> ^operator <o1> +)
#	(<o1> ^name place-adjacent)
#-->
#	(<s> ^operator <o1> >)
#}

sp {prefer*reinforce
	(state <s> ^operator <o1> +)
	(<o1> ^name reinforce)
-->
	(<s> ^operator <o1> > =)
}

#sp {prefer*add-to-compound
#	(state <s> ^operator <o1> +)
#	(<o1> ^name add-to-compound)
#-->
#	(<s> ^operator <o1> >)
#}

#sp {prefer*reinforce*than*other
#	(state <s> ^operator <o1> + <o2> +)
#	(<o1> ^name <> reinforce)
#	(<o2> ^name reinforce)
#-->
#	(<s> ^operator <o2> > <o1>)
#}

#sp {prefer*place-top*than*place-adjacent
#	(state <s> ^operator <o1> + <o2> +)
#	(<o1> ^name place-adjacent ^p3 top)
#	(<o2> ^name place-adjacent ^p3 <> top)
#-->
#	(<s> ^operator <o1> > <o2>)
#}


#current evaluation depth
sp {selection*propose*init-current-evaluation-depth*top-selection
   (state <s> ^name selection
              ^top-selection true
             -^current-evaluation-depth
             -^superstate.elaborations.minimum-explorer-exit-distance)
-->
   (<s> ^operator <op> + =, >)
   (<op> ^name init-current-evaluation-depth
         ^value 1)
}

sp {monitor*operators*top-state
	(state <s> ^operator.name <oname>
	^superstate nil)
-->
	(write (crlf) <s> |: | <oname> (crlf))
}

sp {monitor*operators*sub-state*1
	(state <s> ^operator <o>
	^duplicate-of)
	(<o> ^name <oname> ^p1 <v1> -^p2)
-->
	(write (crlf) <s> |: | <oname> | | <v1> (crlf))
}

sp {monitor*operators*sub-state*2
	(state <s> ^operator <o>
	^duplicate-of)
	(<o> ^name <oname> ^p1 <v1> ^p2 <v2> -^p3)
-->
	(write (crlf) <s> |: | <oname> | | <v1> | | <v2> (crlf))
}

sp {monitor*operators*sub-state*3
	(state <s> ^operator <o>
	^duplicate-of)
	(<o> ^name <oname> ^p1 <v1> ^p2 <v2> ^p3 <v3> -^p4)
-->
	(write (crlf) <s> |: | <oname> | | <v1> | | <v2> | | <v3> (crlf))
}

sp {monitor*operators*sub-state*4
	(state <s> ^operator <o>
	^duplicate-of)
	(<o> ^name <oname> ^p1 <v1> ^p2 <v2> ^p3 <v3> ^p4 <v4>)
-->
	(write (crlf) <s> |: | <oname> | | <v1> | | <v2> | | <v3> | | <v4> (crlf))
}


sp {build*monitor*init
   (state <s> ^name game
^superstate nil)
-->
(<s> ^depth-from-top 0)
}

sp {elaborate*depth*from*top
(state <s> ^duplicate-of <ss>)
(<ss> ^depth-from-top <depth>)
-->
(<s> ^depth-from-top (+ 1 <depth>))
}

sp {build-monitor*print*info
	(state <s> ^superstate <ss> ^depth-from-top <dft> ^current-evaluation-depth <cur-dep>)
	(<ss> ^remaining-operators <remaining> ^item-count <branching-factor>)
	-(state <s2> ^duplicate-of <s>)
-->
	(write (crlf) |Depth-from-top | <dft> (crlf) |Branching factor | <branching-factor> (crlf)|Remaining branches | <remaining> (crlf) |Remaining depth limit | <cur-dep> (crlf))
}


sp {ebalorate*new-tower
   (state <s> ^name game
              ^elaborations <e>
			  ^duplicate-of <prev-s>)
	(<e> ^tower.p1 <t>)
	(<prev-s> -^elaborations.tower.p1 <t>) #new tower
-->
	(<s> ^new-tower <t>)
}

#A tower may disppear if an adjacent object on left/rigth is added to the compound
sp {ebalorate*disappearing*tower
   (state <s> ^name game
              ^elaborations <e>
			  ^duplicate-of <prev-s>)
	(<e> -^tower.p1 <t>)
	(<prev-s> ^elaborations.tower.p1 <t>) #disappearing tower
-->
	(<s> ^disappearing-tower <t>)
}

sp {ebalorate*higher-tower
   (state <s> ^name game
              ^elaborations <e>
			  ^duplicate-of <prev-s>
			  ^gs <gs>)
	(<gs> ^object-size <size>)
	(<size> ^p1 <t> ^p3 <height>)
	(<e> ^tower.p1 <t>)
	(<prev-s> ^elaborations.tower.p1 <t> ^gs.object-size <old-size>)
	(<old-size> ^p1 <t> ^p3 {<old-height> < <height>})
-->
	(<s> ^higher-tower <t>)
}


sp {apply*analyze-state*bump*new-tower*test
   (state <s> ^name game
              ^operator.name analyze-state
			  ^gs <gs>
              ^current-evaluation-depth <ced>)
	(<s> ^new-tower <t>
		-^disappearing-tower)
	(<gs> ^object-size <size>)
	(<size> ^p1 <t> ^p3 <height>)
-->
   (<s> ^current-evaluation-depth <ced> -
                                  (+ <ced> 1))
   (write (crlf) |Bump 1 due to appearence of tower | <t> | of height | <height> (crlf))
}

sp {apply*analyze-state*bump*higher-tower*test
   (state <s> ^name game
              ^operator.name analyze-state
			  ^gs <gs>
              ^current-evaluation-depth <ced>)
	(<s> ^higher-tower <t>)
	(<gs> ^object-size <size>)
	(<size> ^p1 <t> ^p3 <height>)
-->
   (<s> ^current-evaluation-depth <ced> -
                                  (+ <ced> 1))
   (write (crlf) |Bump 1 due to higher tower | <t> | of height | <height> (crlf))
}

sp {apply*analyze-state*decrease*tower*test
   (state <s> ^name game
              ^operator.name analyze-state
			  ^gs <gs>
              ^current-evaluation-depth <ced>)
	(<s> ^disappearing-tower <t>
		-^new-tower)
	(<gs> ^object-size <size>)
	(<size> ^p1 <t> ^p3 <height>)
-->
   (<s> ^current-evaluation-depth <ced> -
                                  (- <ced> 1))
   (write (crlf) |Decrease 1 due to disappearing of tower | <t>  | of height | <height> (crlf))
}

learn --d