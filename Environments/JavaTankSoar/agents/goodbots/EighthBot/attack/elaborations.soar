echo "\nLoading attack/elaborations"


### TURN RADAR ON WHEN ATTACKING
sp {elaborate*radar*attack-on
   (state <s> ^name attack
              ^operator.actions <a>)
-->
   (<a> ^actions.radar.switch on)
}



## convert string-format # to integer-format for use in duck-and-shoot
## NUMBERS ARE OFFSET BY ONE b/c if enemy is X units away, i need the middle (X-1)
## squares to be blocked or open.
sp {elaborate*string-to-integer
   (state <s> ^name tanksoar)
-->
   (<s> ^string-to-integer <sti>)
   (<sti> ^one       2
          ^two       3
          ^three     4
          ^four      5
          ^five      6
          ^six       7
          ^seven     8
          ^eight     9
          ^nine     10
          ^ten      11
          ^eleven   12
          ^twelve   13
          ^thirteen 14
          ^fourteen 15)
}


## determine line-of-fire paths in front of tank

#################################################################
###  ONE SQUARE IN FRONT
#################################################################
sp {elaborate*line-of-fire*one-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>)
   (<sq> ^<h>.{ << open >> <ob>} <ans>)
-->
   (<st> ^line-of-fire.one.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*one-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.one <lf>)
   (<sq> ^<h>.<sdir>.{ << open >> <ob>} <ans>)
-->
   (<lf> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}


#################################################################
###  TWO SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*two-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^one.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^two.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*two-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.one <lf_1>
         ^line-of-fire.two <lf_2>)
   (<sq> ^<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_1> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_2> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}



#################################################################
###  THREE SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*three-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^two.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^three.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*three-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.two <lf_A>
         ^line-of-fire.three <lf_B>)
   (<sq> ^<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}




#################################################################
###  FOUR SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*four-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^three.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^four.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*four-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.three <lf_A>
         ^line-of-fire.four <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}



#################################################################
###  FIVE SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*five-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^four.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^five.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*five-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.four <lf_A>
         ^line-of-fire.five <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}


#################################################################
###  SIX SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*six-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^five.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^six.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*six-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.five <lf_A>
         ^line-of-fire.six <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}




#################################################################
###  SEVEN SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*seven-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^six.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^seven.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*seven-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.six <lf_A>
         ^line-of-fire.seven <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}



#################################################################
###  EIGHT SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*eight-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^seven.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^eight.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*eight-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.seven <lf_A>
         ^line-of-fire.eight <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}


#################################################################
###  NINE SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*nine-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^eight.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^nine.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*nine-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.eight <lf_A>
         ^line-of-fire.nine <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}


#################################################################
###  TEN SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*ten-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^nine.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^ten.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*ten-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.nine <lf_A>
         ^line-of-fire.ten <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}




#################################################################
###  ELEVEN SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*eleven-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^ten.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^eleven.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*eleven-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.ten <lf_A>
         ^line-of-fire.eleven <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}



#################################################################
###  twelve SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*twelve-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^eleven.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^twelve.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*twelve-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.eleven <lf_A>
         ^line-of-fire.twelve <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}



#################################################################
###  THIRTEEN SQUARES IN FRONT
#################################################################
sp {elaborate*line-of-fire*13-center
   (state <s> ^name tanksoar
              ^io.input-link.direction <h>
              ^status <st>
              ^direction-map <dm>)
   (<st> ^square <sq>
         ^line-of-fire <lf>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.{ << open >> <ob>} <ans>)
   (<lf> ^twelve.center.<ob> <ans>)    ### previous square must have open path to it as well (recursive property)
-->
   (<lf> ^thirteen.center <pos>)
   (<pos> ^<ob> <ans>)
}

sp {elaborate*line-of-fire*13-left-right
   (state <s> ^name tanksoar
              ^io.input-link <il>
              ^status <st>
              ^direction-map.<h>.{ << left right >> <dir>} <sdir>)
   (<st> ^square <sq>)
   (<il> ^direction <h>)
   (<st> ^square <sq>
         ^line-of-fire.twelve <lf_A>
         ^line-of-fire.thirteen <lf_B>)
   (<sq> ^<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<h>.<sdir>.{ << open >> <ob>} <ans>)
   (<lf_A> ^<dir>.<ob> <ans>)             ### previous square must have open path to it as well (recur. prop.)
-->
   (<lf_B> ^<dir> <pos>)
   (<pos> ^<ob> <ans>)
}