# to test:
# see entity, entity goes away, entity comes back, ... - DONE
# get message about entity, get another message about entity, ... - DONE
# get message about entity, then see entity, ... - DONE
# see entity, entity goes away, get message about entity
# multiple entities?

#
# if we've never seen the entity before, then make an "entry" for it in the entities structure
#

sp {simple-robot*propose*maintain-entity-new
   (state <s> ^name simple-robot
              ^io.input-link.entities.entity <e>
              ^entities <es>)
   (<e> ^id <id>)
  -(<es> ^entity.id <id>) 
-->
   (<s> ^operator <op> +)
   (<op> ^name maintain-entity-new
         ^id <id>)
}

sp {apply*maintain-entity-new
   (state <s> ^operator <op>
              ^entities <es>)
   (<op> ^name maintain-entity-new
         ^id <id>)
-->
   (<es> ^entity <e>)
   (<e> ^id <id>
        ^last-update-message-time -1000) #force message to be sent immediately (if agent decides to send at all)
   (write (crlf) |Creating new entry for entity | <id>)
}