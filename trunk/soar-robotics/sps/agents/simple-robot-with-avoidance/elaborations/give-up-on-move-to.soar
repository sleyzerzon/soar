# these elaboration rules fire in the top-state, but are used by the give-up-on-destination-waypoint operator in the go-to-location substate

sp {simple-robot*elaborate*destination-waypoint-give-up*out-of-time
   (state <s> ^name simple-robot
              ^destination-waypoint <dw>
              ^parameters.min-progress-distance <mpd>)
   (<dw> ^progress < <mpd>)
-->
   (<dw> ^give-up true)
}

# this could happen if the agent gets a message enroute that says the destination can't be reached directly from the source
sp {simple-robot*elaborate*destination-waypoint-give-up*destination-unreachable
   (state <s> ^name simple-robot
              ^destination-waypoint <mt>)
   (<mt> ^source <src>
         ^waypoint <dest>)
  -(<src> ^next <dest>)
-->
   (<mt> ^give-up true
         ^give-up immediate)
}