!define APPNAME "nameandversion"
!define APPNAMEANDVERSION "nameandversion"
!define MSPROGRAMSNAME "msprogramsname"
!define INSTALLDIR "installdir"
!define OUTFILE "outfile"

Name "${APPNAMEANDVERSION}"
InstallDir "$PROGRAMFILES/${INSTALLDIR}"
InstallDirRegKey HKLM "Software/${APPNAME}" ""
OutFile "${OUTFILE}"

BrandingText "The Center for Cognitive Architecture"

!include "MUI.nsh"

Icon "Resources/Icons/soar.ico"
UninstallIcon "Resources/Icons/un-soar.ico"
!define MUI_ICON "Resources/Icons/soar.ico"
!define MUI_UNICON "Resources/Icons/un-soar.ico"
!define MUI_ABORTWARNING
!define MUI_COMPONENTSPAGE_SMALLDESC
!define MUI_HEADERIMAGE
!define MUI_HEADERIMAGE_NOSTRETCH
!define MUI_HEADERIMAGE_BITMAP "Resources/Icons/soarinstaller.bmp"

!insertmacro MUI_PAGE_WELCOME
!insertmacro MUI_PAGE_LICENSE "COPYING"
!insertmacro MUI_PAGE_COMPONENTS
!insertmacro MUI_PAGE_DIRECTORY
!insertmacro MUI_PAGE_INSTFILES

!define MUI_FINISHPAGE_LINK "Visit the Soar home page for news and updates!"
!define MUI_FINISHPAGE_LINK_LOCATION "http://sitemaker.umich.edu/soar"
!define MUI_FINISHPAGE_SHOWREADME_TEXT "View Release Notes"
!define MUI_FINISHPAGE_SHOWREADME "$INSTDIR/Announce.txt"

!insertmacro MUI_PAGE_FINISH

!insertmacro MUI_UNPAGE_CONFIRM
!insertmacro MUI_UNPAGE_INSTFILES

!insertmacro MUI_LANGUAGE "English"
!insertmacro MUI_RESERVEFILE_LANGDLL

Section "Core Soar Components" Section1

	SetDetailsPrint textonly
	DetailPrint "Installing core Soar components..."
	SetDetailsPrint listonly

	SectionIn RO
	SetOverwrite on

	corefiles
	
	CreateDirectory "$SMPROGRAMS/${MSPROGRAMSNAME}"
	CreateDirectory "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation"
	CreateDirectory "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI"
	CreateDirectory "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations"
	CreateDirectory "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/"

	SetOutPath "$INSTDIR/Environments/JavaTOH"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Start Towers of Hanoi (Java).lnk" "$INSTDIR/Environments/JavaTOH/run-toh.bat" "" "$INSTDIR/Resources/Icons/toh.ico"

	SetOutPath "$INSTDIR/Environments/JavaMissionaries"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Start Missionaries and Cannibals (Java).lnk" "$INSTDIR/Environments/JavaMissionaries/run-mac.bat" "" "$INSTDIR/Resources/Icons/mac.ico"

	SetOutPath "$INSTDIR/Environments/JavaTankSoar"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Start TankSoar (Java).lnk" "$INSTDIR/Environments/JavaTankSoar/run-JavaTankSoar.bat" "" "$INSTDIR/Resources/Icons/tanksoar.ico"

	SetOutPath "$INSTDIR/Environments/JavaEaters"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Start Eaters (Java).lnk" "$INSTDIR/Environments/JavaEaters/run-JavaEaters.bat" "" "$INSTDIR/Resources/Icons/eaters.ico"

	SetOutPath "$INSTDIR/SoarLibrary/bin"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Start Soar Debugger (Java).lnk" "$INSTDIR/SoarLibrary/bin/SoarJavaDebugger.jar" "" "$INSTDIR/Resources/Icons/soar.ico"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Announcement.lnk" "$INSTDIR/Documentation/Announce.txt"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/License.lnk" "$INSTDIR/License.txt"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Uninstall ${APPNAMEANDVERSION}.lnk" "$INSTDIR/Uninstall ${APPNAMEANDVERSION}.exe" "" "$INSTDIR/Resources/Icons/un-soar.ico"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Start VisualSoar (Java).lnk" "$INSTDIR/SoarLibrary/bin/VisualSoar.jar" "" "$INSTDIR/Resources/Icons/vs.ico"
	CreateShortCut "$INSTDIR/FilterTcl.lnk" "$INSTDIR/Tools/FilterTcl/start-filter.bat" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/FilterC.lnk" "$INSTDIR/SoarLibrary/bin/FilterC.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/LoggerWinC.lnk" "$INSTDIR/SoarLibrary/bin/LoggerWinC.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestClientSML.lnk" "$INSTDIR/SoarLibrary/bin/TestClientSML.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestCLI.lnk" "$INSTDIR/SoarLibrary/bin/TestCLI.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestConnectionSML.lnk" "$INSTDIR/SoarLibrary/bin/TestConnectionSML.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestMultiAgent.lnk" "$INSTDIR/SoarLibrary/bin/TestMultiAgent.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestSMLEvents.lnk" "$INSTDIR/SoarLibrary/bin/TestSMLEvents.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestSMLPerformance.lnk" "$INSTDIR/SoarLibrary/bin/TestSMLPerformance.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestSoarPerformance.lnk" "$INSTDIR/SoarLibrary/bin/TestSoarPerformance.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TOHSML.lnk" "$INSTDIR/SoarLibrary/bin/TOHSML.exe" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/TestJavaSML.lnk" "$INSTDIR/SoarLibrary/bin/TestJavaSML.jar" "" "$INSTDIR/Resources/Icons/testapp.ico"
	CreateShortCut "$INSTDIR/LoggerJava.lnk" "$INSTDIR/SoarLibrary/bin/LoggerJava.jar" "" "$INSTDIR/Resources/Icons/testapp.ico"
	
	SetOutPath "$INSTDIR/Documentation/"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/Soar Tutorial Part 1.lnk" "$INSTDIR/Documentation/Soar Tutorial Part 1.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/Soar Tutorial Part 2.lnk" "$INSTDIR/Documentation/Soar Tutorial Part 2.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/Soar Tutorial Part 3.lnk" "$INSTDIR/Documentation/Soar Tutorial Part 3.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/Soar Tutorial Part 4.lnk" "$INSTDIR/Documentation/Soar Tutorial Part 4.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/Soar Tutorial Part 5.lnk" "$INSTDIR/Documentation/Soar Tutorial Part 5.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Tutorial/Soar Tutorial Part 6.lnk" "$INSTDIR/Documentation/Soar Tutorial Part 6.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/How to guide -- Adding an event to gSKI and SML.lnk" "$INSTDIR/Documentation/How to guide -- Adding an event to gSKI and SML.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Intro to the Soar Debugger in Java.lnk" "$INSTDIR/Documentation/Intro to the Soar Debugger in Java.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Moving from SGIO to SML.lnk" "$INSTDIR/Documentation/Moving from SGIO to SML.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/SML Quick Start Guide.lnk" "$INSTDIR/Documentation/SML Quick Start Guide.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/SoarXMLInterfaceSpecification.lnk" "$INSTDIR/Documentation/SML High-level presentation.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/soar7-to-soar8.lnk" "$INSTDIR/Documentation/soar7-to-soar8.txt"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/SoarXMLInterfaceSpecification.lnk" "$INSTDIR/Documentation/SoarXMLInterfaceSpecification.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Soar8Manual.lnk" "$INSTDIR/Documentation/Soar8Manual.pdf"
	
	SetOutPath "$INSTDIR/Documentation/gSKI/"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/Commonly-used gSKI constructs.lnk" "$INSTDIR/Documentation/gSKI/Commonly-used gSKI constructs.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/Design Ideas and Concepts for gSKI.lnk" "$INSTDIR/Documentation/gSKI/Design Ideas and Concepts for gSKI.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSKI -- Design Document.lnk" "$INSTDIR/Documentation/gSKI/gSKI -- Design Document.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSKI -- gSKI Summary Document.lnk" "$INSTDIR/Documentation/gSKI/gSKI -- gSKI Summary Document.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSKI -- Outstanding Issues with gSKI.lnk" "$INSTDIR/Documentation/gSKI/gSKI -- Outstanding Issues with gSKI.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSki -- Use cases for gSKI core system design.lnk" "$INSTDIR/Documentation/gSKI/gSki -- Use cases for gSKI core system design.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gski_memory.lnk" "$INSTDIR/Documentation/gSKI/gski_memory.txt"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSKI-Design-Document.lnk" "$INSTDIR/Documentation/gSKI/gSKI-Design-Document.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSKIProductionUseCases.lnk" "$INSTDIR/Documentation/gSKI/gSKIProductionUseCases.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/gSKI-Req.lnk" "$INSTDIR/Documentation/gSKI/gSKI-Req.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/Moving to GSKI.lnk" "$INSTDIR/Documentation/gSKI/Moving to GSKI.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/Requirements Document with Goals.lnk" "$INSTDIR/Documentation/gSKI/Requirements Document with Goals.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/gSKI/Soar TCL Commands in Soar 8.lnk" "$INSTDIR/Documentation/gSKI/Soar TCL Commands in Soar 8.pdf"
	
	SetOutPath "$INSTDIR/Documentation/Presentations/"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations/SML High-level.lnk" "$INSTDIR/Documentation/Presentations/SML High-level presentation.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations/Soar25 - SML - A New Interface Into Soar.lnk" "$INSTDIR/Documentation/Presentations/Soar25-SML-ANewInterfaceIntoSoar.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations/Soar25 - New Debugger.lnk" "$INSTDIR/Documentation/Presentations/Soar25-NewDebugger.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations/Soar25 - Inside Debugger.lnk" "$INSTDIR/Documentation/Presentations/Soar25-InsideDebugger.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations/Soar25 - Command Line Interface.lnk" "$INSTDIR/Documentation/Presentations/Soar25-Command Line Interface.pdf"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Documentation/Presentations/Soar25 - Kernel.lnk" "$INSTDIR/Documentation/Presentations/Soar25-Kernel.pdf"
	
	SetOutPath "$INSTDIR/"
	CreateShortCut "$SMPROGRAMS/${MSPROGRAMSNAME}/Open Soar Folder.lnk" "$INSTDIR"

SectionEnd

Section "Source" Section2

	SetDetailsPrint textonly
	DetailPrint "Installing source..."
	SetDetailsPrint listonly
	
	SetOverwrite ifnewer

	sourcefiles

SectionEnd

Section -FinishSection

	SetDetailsPrint textonly
	DetailPrint "Finishing installation..."
	SetDetailsPrint listonly

	WriteRegStr HKLM "Software/${APPNAME}" "" "$INSTDIR"
	WriteRegStr HKLM "Software/Microsoft/Windows/CurrentVersion/Uninstall/${APPNAMEANDVERSION}" "DisplayName" "${APPNAMEANDVERSION}"
	WriteRegStr HKLM "Software/Microsoft/Windows/CurrentVersion/Uninstall/${APPNAMEANDVERSION}" "DisplayIcon" "$INSTDIR/Resources/Icons/soar.ico"
	WriteRegStr HKLM "Software/Microsoft/Windows/CurrentVersion/Uninstall/${APPNAMEANDVERSION}" "UninstallString" "$INSTDIR/Uninstall ${APPNAMEANDVERSION}.exe"

	WriteUninstaller "$INSTDIR/Uninstall ${APPNAMEANDVERSION}.exe"

SectionEnd

!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN
	!insertmacro MUI_DESCRIPTION_TEXT ${Section1} "Files needed to run Soar, Soar documentation, VisualSoar and external environments."
	!insertmacro MUI_DESCRIPTION_TEXT ${Section2} "Source code for all Soar components."
!insertmacro MUI_FUNCTION_DESCRIPTION_END

Section Uninstall

	SetDetailsPrint textonly
	DetailPrint "Deleting files..."
	SetDetailsPrint listonly

	DeleteRegKey HKLM "Software/Microsoft/Windows/CurrentVersion/Uninstall/${APPNAMEANDVERSION}"
	DeleteRegKey HKLM "SOFTWARE/${APPNAME}"

	Delete "$INSTDIR/Uninstall ${APPNAMEANDVERSION}.exe"

	Delete "$INSTDIR/SoarLibrary/bin/testjavasml-success.txt"
	Delete "$INSTDIR/SoarLibrary/bin/testclientsml-success.txt"
	Delete "$INSTDIR/SoarLibrary/bin/testmultiagent-success.txt"
	Delete "$INSTDIR/SoarLibrary/bin/towers-sml-success.txt"
	Delete "$INSTDIR/SoarLibrary/bin/default-layout.xml"
	Delete "$INSTDIR/SoarLibrary/bin/javaw.exe.manifest"
	Delete "$INSTDIR/SoarLibrary/bin/default-layout.dlf"
	Delete "$INSTDIR/SoarLibrary/bin/default-text.dlf"
	Delete "$INSTDIR/SoarLibrary/bin/VSPreferences.txt"
	RMDir /r "$INSTDIR/Environments/JavaMissionaries/src"

	deletefiles
	
	deletedirs
	
SectionEnd
