<project name="soar-build-common" basedir=".">

	<property name="manifest.vendor" value="University of Michigan"/>
	<property name="copyright" value="(c) The Regents of the University of Michigan, 2009"/>

	<property name="src" location="src/main/java" />
	<property name="lib" location="lib" />
	<property name="doc" location="doc" />
	<property name="sml.lib" location="../../Core/ClientSMLSWIG/Java" />
	<property name="smljava.lib" location="../soar-smljava/lib" />
	<property name="soarlib" location="../../SoarLibrary" />
	<property name="soarlib.lib" location="${soarlib}/lib" />
	<property name="soarlib.bin" location="${soarlib}/bin" />

	<property name="target" location="target" />
	<property name="target.classes" location="${target}/classes" />
	<property name="main.resources" location="src/main/resources" />

	<property name="java.source.level" value="1.6"/>
	<property name="java.target.level" value="1.6"/>
	
	<property name="jar.name" value="${ant.project.name}-${version}.jar"/>
	<property name="jar.source.name" value="${ant.project.name}-${version}.src.jar"/>

	<property name="manifest.classpath" value=""/>

	<property name="doc.packagenames" value="edu.umich.*"/>
	<property name="doc.sourcepath" location="${src}"/>
	<property name="doc.excludepackagenames" value="edu.umich.demos.*"/>
	<property name="doc.destdir" location="${doc}/${ant.project.name}/api"/>
	<property name="doc.windowtitle" value="${ant.project.name} ${version}"/>

	<target name="init">
		<mkdir dir="${target}" />
		<mkdir dir="${target.classes}" />

		<!-- Set up the build path used throughout the build script  -->
		<path id="compile.libs">
			<fileset dir="${lib}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${sml.lib}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${smljava.lib}">
				<include name="*.jar" />
			</fileset>
		</path>
	</target>

	<target name="compile" depends="init">
		<javac destdir="${target.classes}" debug="on" optimize="on" target="${java.target.level}" source="${java.source.level}">
			<src path="${src}" />
			<classpath refid="compile.libs"/>
		</javac>

		<copy todir="${target.classes}">
			<fileset dir="${main.resources}">
				<exclude name="**/.svn"/>
			</fileset>
		</copy>
	</target>

	<target name="create-jar" depends="compile">
		<tstamp />
		<jar destfile="${lib}/${jar.name}">
			<fileset dir="${target.classes}"/>
			<manifest>
				<attribute name="Title" value="${ant.project.name} ${version}" />
				<attribute name="Vendor" value="${manifest.vendor}" />
				<attribute name="Date" value="${TODAY} ${TSTAMP}" />
				<attribute name="Version" value="${version}" />
				<attribute name="Built-By" value="${user.name}" />
				<attribute name="Copyright" value="${copyright}" />
				<attribute name="Main-Class" value="${jar.main.class}" />
				<attribute name="Class-Path" value=". ${manifest.classpath}" />
			</manifest>
		</jar>
			
		<!-- Create source jar -->
		<jar destfile="${lib}/${jar.source.name}">
			<fileset dir="${src}">
				<exclude name="**/.svn" />
			</fileset>
		</jar>
	</target>

	<target name="jar" depends="create-jar">
		<copy todir="${soarlib.lib}">
			<fileset dir="${lib}" />
		</copy>
	</target>

	<target name="clean">
		<delete dir="${target}" />
		<delete dir="${lib}/${jar.name}" />
	</target>

	<target name="doc" depends="init" description="Generate API documentation">
		<javadoc packagenames="${doc.packagenames}"
			sourcepath="${src}"
			classpathref="compile.libs"
			excludepackagenames="${doc.excludepackagenames}"
			defaultexcludes="yes"
			destdir="${doc.destdir}"
			author="true"
			version="true"
			use="true"
			windowtitle="${doc.windowtitle}">
			<doctitle><![CDATA[<h1><a href="http://sitemaker.umich.edu/soar">Soar</a> ${version}</h1>]]></doctitle>
			<bottom><![CDATA[<i>${copyright}</i>]]></bottom>
		</javadoc>
	</target>

</project>

