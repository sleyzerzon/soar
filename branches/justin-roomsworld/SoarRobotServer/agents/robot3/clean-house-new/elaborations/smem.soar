## Clean up after Smem commands

#sp {smem*detect-error
#   (state <s> ^smem.result.bad-cmd <d>)
#-->
####(write (crlf) | BAD COMMAND!!|)
#   (interrupt)
#}

sp {apply*clean-up*retrieve
   :o-support
   (state <s> ^name {<> delivery}
             -^superstate.name delivery
              ^smem <smem>)
   (<smem> ^result. << success failure >> <q>
           ^command <cmd>)
   (<cmd> ^retrieve <q>)
-->
   (<cmd> ^retrieve <q> -)
}

sp {apply*clean-up*query
   :o-support
   (state <s> ^name {<> delivery}
             -^superstate.name delivery
              ^smem <smem>)
   (<smem> ^result. << success failure >> <q>
           ^command <cmd>)
   (<cmd> ^query <q>)
-->
   (<cmd> ^query <q> -)
}

sp {apply*clean-up*store
   :o-support
   (state <s> ^name {<> delivery}
             -^superstate.name delivery
              ^smem <smem>)
   (<smem> # ^result.success <store>
           ^command <cmd>)
   (<cmd> ^store <store>)
-->
   (<cmd> ^store <store> -)
}
