waitsnc -e

#sp {cursor-target-bbox-int
#	(state <s> 
#		^superstate nil
#		^svs (
#			^command <c>
#			^spatial-scene (
#				^child.id cursor
#				^child.id target
#			)
#		)
#	)
#-->
#	(<c> ^extract <e>)
#	(<e> ^negate t
#	     ^type bbox_int
#	     ^a <a>
#	     ^b <b>)
#	(<a> ^type bbox ^node <anode>) (<anode> ^type node ^name cursor)
#	(<b> ^type bbox ^node <bnode>) (<bnode> ^type node ^name target)
#}

sp {cursor-target-intersect
	(state <s> 
		^superstate nil
		^svs (
			^command <c>
			^spatial-scene (
				^child.id cursor
				^child.id target
			)
		)
	)
-->
	(<c> ^extract <e>)
	(<e> ^type intersect ^a <a> ^b <b>)
	(<a> ^type node ^name cursor)
	(<b> ^type node ^name target)
}

sp {create-velocity-model
	(state <s> ^superstate nil
	           ^svs.command <c>)
-->
	(<c> ^create-model <m>)
	(<m> ^type velocity
	     ^name vel)
}

sp {create-lwr-model
	(state <s> ^superstate nil
	           ^svs.command <c>)
-->
	(<c> ^create-model <m>)
	(<m> ^type lwr
	     ^name lwr
	     ^inputs <in>
	     ^outputs <out>)
	(<in> ^p <p> ^v <v>)
	(<out> ^p <op>)
}

#sp {assign-vel-model
#	(state <s> ^superstate nil
#	           ^svs.command <c>)
#-->
#	(<c> ^assign-model <m>)
#	(<m> ^name vel ^inputs <in> ^outputs <out>)
#	(<in> ^px cursor:px
#	      ^py cursor:py
#		  ^pz cursor:pz
#		  ^vx vx
#		  ^vy vy
#		  ^vz vz)
#	(<out> ^px cursor:px
#	       ^py cursor:py
#		   ^pz cursor:pz)
#}

sp {assign-lwr-model
	(state <s> ^superstate nil
	           ^svs.command <c>)
-->
	(<c> ^assign-model <m1> <m2> <m3>)
	(<m1> ^name lwr ^inputs <in1> ^outputs <out1>)
	(<in1> ^p cursor:px ^v vx)
	(<out1> ^p cursor:px)
	(<m2> ^name lwr ^inputs <in2> ^outputs <out2>)
	(<in2> ^p cursor:py ^v vy)
	(<out2> ^p cursor:py)
	(<m3> ^name lwr ^inputs <in3> ^outputs <out3>)
	(<in3> ^p cursor:pz ^v vz)
	(<out3> ^p cursor:pz)
}

sp {seek-target
	(state <s>
		^superstate nil
		^svs (
			^command <c>
			^spatial-scene (
				^child.id cursor
				^child.id target
			)
		)
	)
-->
	(<c> ^control <ctrl>)
	(<ctrl> ^outputs <out>
	        ^objective <obj>
	        ^model <mdl>
	        ^depth 1
	        ^type naive)
	(<out> ^vx <vx> ^vy <vy> ^vz <vz>)
	(<vx> ^min -1.0 ^max 1.0 ^inc 1.0)
	(<vy> ^min -1.0 ^max 1.0 ^inc 1.0)
	(<vz> ^min -1.0 ^max 1.0 ^inc 1.0)
	(<obj> ^name euclidean
	       ^a cursor
	       ^b target)
}

sp {add-distance-property
	(state <s> ^superstate nil
	           ^svs ( ^command <c>
	                  ^spatial-scene ( ^child.id cursor ^child.id target ) )
	)
-->
	(<c> ^property <p>)
	(<p> ^object cursor
	     ^property dist-to-target
	     ^filter <f>)
	(<f> ^type distance ^a <a> ^b <b>)
	(<a> ^type node ^name cursor)
	(<b> ^type node ^name target)
}
