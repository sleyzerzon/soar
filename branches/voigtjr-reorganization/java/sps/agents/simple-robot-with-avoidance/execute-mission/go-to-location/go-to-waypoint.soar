sp {go-to-location*propose*go-to-waypoint*destination-waypoint
   (state <s> ^name go-to-location
              ^top-state <ts>
              ^top-state.destination-waypoint <dw>)
   (<dw> ^waypoint <wp>
         ^source <so>)
  -(<ts> ^current-waypoint <> <so>)
  -(<ts> ^current-waypoint <wp>)
-->
   (<s> ^operator <op> +)
   (<op> ^name go-to-waypoint
         ^destination <dw>)
}

# 1) create waypoint structure on input-link (done by choose-waypoint)
# 2) rotate-to to the desired heading
# 3) create structures to track movement
# 4) move/rotate to the desired location (in subgoal)

sp {elaborate*operator*go-to-waypoint*waypoint
   (state <s> ^io.input-link.self.waypoints.waypoint <w>
              ^operator <o>)
   (<o> ^name go-to-waypoint
        ^destination.waypoint.id <id>)
   (<w> ^id <id>)
-->
   (<o> ^waypoint <w>)
}

sp {apply*operator*go-to-waypoint*current-waypoint*remove
   (state <s> ^waypoints <wps>
              ^top-state <ts>
              ^operator <o>)
   (<o> ^name go-to-waypoint)
   (<ts> ^current-waypoint <cw>)
   (<wps> -^near-waypoint <cw>)
-->
   (<ts> ^current-waypoint <cw> -)
}

sp {monitor*go-to-waypoint
   (state <s> ^operator <o>)
   (<o> ^name go-to-waypoint
        ^destination.waypoint <d>)
   (<d> ^id <id> ^x <x> ^y <y>)
-->
   (write (crlf) |Going to | <id> | (| <x> |,| <y> |)|)
}
