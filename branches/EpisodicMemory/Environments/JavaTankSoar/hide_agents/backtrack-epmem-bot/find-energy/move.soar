
#If I'm not blocked in a particular direction, 
#propose moving in that direction
sp {find-energy*propose*move
   (state <s> ^name find-energy
              ^io.input-link <il>
              ^top-state.blocked.<abs-dir> no)
   (<il> ^x <x>
         ^y <y>)
-->
   (<s> ^operator <op> + =)
   (<op> ^name move
         ^abs-dir <abs-dir>)
}

#%%%DEBUGGING: Report when an epmem has radar
sp {find-energy*epmem-has-radar
   (state <s> ^name find-energy
              ^epmem.retreived.io.input-link.radar)
-->
   (write (crlf) |EPMEM has radar|)
}

#IF I've retrieved a memory of seeing
#   the energy charger in a particular direction
#   from my current position
#THEN prefer moving in that direction
sp {find-energy*compare*move*epmem-available
   (state <s> ^name find-energy
              ^io.input-link <il>
              ^epmem.retrieved.io.input-link <ril>
              ^operator <op1> +
                        <op2> +)
   (<il> ^x <x>
         ^y <y>)
   (<ril> 
#          ^x <x>
#          ^y <y>
          ^radar.energy <energy>
          ^direction <dir>)
   (<op1> ^name move
          ^abs-dir <dir>)
   (<op2> ^name move
          ^abs-dir <> <dir>)
-->
   (<s> ^operator <op1> > <op2>)
   (write (crlf) |EPMEM: I last saw energy | <dir> | of here.|)
}

#IF no memory is available 
#THEN prefer moving the direction I'm facing
sp {find-energy*compare*move*prefer-forward
   (state <s> ^name find-energy
             -^top-state.last-energy-epmem
              ^io.input-link.direction <dir>
              ^operator <op1> +
                        <op2> +)
   (<op1> ^name move
          ^abs-dir <dir>)
   (<op2> ^name move
         -^abs-dir <dir>)
-->
   (<s> ^operator <op1> > <op2>)
}


#Move in the selected direction
sp {apply*move
   (state <s> ^operator <op>)
   (<op> ^name move
         ^abs-dir <abs-dir>)
-->
#   (write (crlf) |=================== Moving | <abs-dir> | =======================|)
}

