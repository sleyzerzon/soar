sp {process-unfriendly-entity*propose*send-position-message
   (state <s> ^name process-unfriendly-entity
              ^io.input-link.time.seconds <time>
              ^entity <e-io>
              ^top-state.entity <e-ts>)
   (<e-ts> ^id <id>
           ^next-message-update-time <= <time>)
   (<e-io> ^id <id>
           ^current-absolute-location  <ap>)
   (<ap> ^x <x>
         ^y <y>)
-->
   (<s> ^operator <op> +)
   (<op> ^name send-position-message
         ^id <id>
         ^x <x>
         ^y <y>
         ^time <time>)
}

# message: entity-report position-update <id> <x> <y>
sp {apply*send-position-message
   (state <s> ^operator <op>
              ^io.output-link <ol>
              ^top-state.entity <e>)
   (<op> ^name send-position-message
         ^id <id>
         ^x <x>
         ^y <y>
         ^time <time>)
   (<e> ^id <id>
        ^last-update-message-time <lmut>)
-->
   (<e> ^last-update-message-time <lmut> - <time>)
   (<ol> ^broadcast-message <w1>)
   (<w1> ^word entity-report
         ^next <w2>)
   (<w2> ^word position-update
         ^next <w3>)
   (<w3> ^word <id>
         ^next <w4>)
   (<w4> ^word <x>
         ^next <w5>)
   (<w5> ^word <y>
         ^next nil)
}
